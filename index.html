<!doctype html>
<html lang="de" class="theme-nebula">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ARea Editor v3.0</title>
<script>(function(){try{const t=localStorage.getItem('theme')||'theme-nebula';const html=document.documentElement;['theme-slate','theme-aurora','theme-nebula'].forEach(c=>html.classList.remove(c));html.classList.add(t);}catch{}})();</script>
<style>
:root { color-scheme: dark; }
:root.theme-slate{--bg:#161b23;--panel:#111828;--panel2:#192339;--text:#e9ecf5;--muted:#9fb3d9;--border:#24314a;--accent:#60a5fa;--accent2:#93c5fd;color-scheme:dark}
:root.theme-aurora{--bg:#062026;--panel:#06242b;--panel2:#08323c;--text:#e6fffb;--muted:#93d9d1;--border:#0f3a43;--accent:#22d3ee;--accent2:#67e8f9;color-scheme:dark}
:root.theme-nebula{--bg:#080e19;--bg-grad:radial-gradient(1100px 800px at 12% 0%, #2c3f84 0%, transparent 58%),radial-gradient(1200px 900px at 88% 8%, #6d3a99 0%, transparent 60%),radial-gradient(900px 700px at 18% 86%, #2d6bb4 0%, transparent 62%),linear-gradient(180deg,#0a0f1e 0%,#10182a 100%);--glass:rgba(255,255,255,0.07);--glass-2:rgba(255,255,255,0.10);--glass-border:rgba(255,255,255,0.18);--glass-blur:14px;--panel:#0e1424;--panel2:#121a2e;--text:#e8eefb;--muted:#a9b7da;--border:#1e2a45;--accent:#7dd3fc;--accent2:#a78bfa;--sweep-bg:linear-gradient(90deg,color-mix(in srgb,var(--accent2) 70%,transparent),color-mix(in srgb,var(--accent) 65%,transparent));--sweep-fg:#0a0f1e;color-scheme:dark}
html,body,.panel,.btn,.menubtn,.menu-pop,.toolbtn,.status-badge,.status-pill,.tab,.del,.select,.input,.section>summary{transition:background-color .25s ease,color .25s ease,border-color .25s ease,box-shadow .25s ease}
*{box-sizing:border-box}html,body{height:100%;margin:0;background:var(--bg);color:var(--text);font:14px/1.45 ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol",sans-serif}
:root.theme-nebula body{background:#0a0f1e}:root.theme-nebula body::before{content:"";position:fixed;inset:0;z-index:-1;pointer-events:none;background:var(--bg-grad)}
.top{height:56px;display:flex;gap:8px;align-items:center;padding:0 12px;background:var(--panel);border-bottom:1px solid var(--border);position:relative;z-index:10}
:root.theme-nebula .top{border-radius:0 0 18px 18px;background:linear-gradient(135deg,rgba(125,211,252,.20),rgba(167,139,250,.14)),var(--glass);border-bottom-color:var(--glass-border)}
.brand-logo{display:inline-flex;align-items:center}.brand-logo img{height:50px;display:block}
.ui-pill{position:relative;display:inline-flex;align-items:center;gap:8px;padding:10px 14px;border-radius:12px;font-weight:800;cursor:pointer;border:1px solid color-mix(in srgb,var(--border) 85%,transparent);background:linear-gradient(180deg,color-mix(in srgb,var(--panel2) 80%,var(--accent) 20%) 0%,color-mix(in srgb,var(--panel2) 88%,var(--accent2) 12%) 100%);color:var(--text);box-shadow:0 10px 24px rgba(0,0,0,.35),0 0 0 1px rgba(255,255,255,.04),0 6px 16px -6px color-mix(in srgb,var(--accent) 35%,transparent);transition:transform .15s ease,box-shadow .2s ease,border-color .2s ease,background .2s ease}
.ui-pill:hover{transform:translateY(-1px);border-color:color-mix(in srgb,var(--accent) 35%,var(--border));box-shadow:0 12px 28px rgba(0,0,0,.38),0 0 0 1px rgba(255,255,255,.05),0 10px 22px -8px color-mix(in srgb,var(--accent) 45%,transparent);background:linear-gradient(180deg,color-mix(in srgb,var(--panel2) 74%,var(--accent) 26%) 0%,color-mix(in srgb,var(--panel2) 84%,var(--accent2) 16%) 100%)}
.ui-pill:active{transform:translateY(0)}
.ui-pill.sweep{overflow:hidden;isolation:isolate}
.ui-pill.sweep::after{content:"";position:absolute;left:-25%;right:-25%;top:0;bottom:0;background:var(--sweep-bg);transform:skewX(-45deg) scaleX(0);transform-origin:left center;transition:transform .5s ease;opacity:.85;z-index:0}
.ui-pill.sweep:hover::after{transform:skewX(-45deg) scaleX(1)}
.ui-pill.sweep>*{position:relative;z-index:1}.ui-pill.sweep:hover{color:var(--sweep-fg)}
.sp{flex:1}
.status-pill{padding:6px 10px;border:1px solid var(--border);border-radius:999px;font-size:12px;font-weight:600;background:var(--panel2)}
.wrap{height:calc(100vh - 56px);display:grid;grid-template-columns:minmax(220px,280px) minmax(320px,1fr) minmax(280px,420px);gap:10px;padding:10px;overflow:hidden}
@media (max-width:1000px){.wrap{grid-template-columns:minmax(200px,260px) minmax(320px,1fr)}.wrap>.panel:nth-child(3){grid-column:1/-1}}@media (max-width:680px){.wrap{grid-template-columns:1fr}}
.panel{background:var(--panel);border:1px solid var(--border);border-radius:14px;overflow:hidden;display:flex;flex-direction:column;min-height:0}
:root.theme-nebula .panel{border-radius:18px;box-shadow:0 16px 44px rgba(0,0,0,.46),0 0 0 1px rgba(255,255,255,.06),0 0 40px -8px color-mix(in srgb,var(--accent2) 45%,transparent)}
.panel h3{margin:0;padding:10px 12px;border-bottom:1px solid var(--border);font-size:12px;color:var(--muted);text-transform:uppercase;letter-spacing:.08em}
.content{padding:10px;overflow:auto;scrollbar-gutter:stable both-edges}
#sceneList{overflow-y:auto;overflow-x:hidden}
.row{display:grid;grid-template-columns:24px 24px 1fr auto;gap:6px;align-items:center;padding:6px 8px;border-radius:8px}
.row:hover{background:var(--panel2)}
.icon{width:24px;height:24px;display:flex;align-items:center;justify-content:center;cursor:pointer;border:1px solid var(--border);border-radius:8px;background:var(--panel2)}
.tab{background:transparent;border:1px solid transparent;padding:6px 8px;border-radius:8px;cursor:pointer;color:var(--text);font-weight:700;min-width:0;text-align:left}
.tab.active{border-color:var(--accent);box-shadow:inset 0 0 0 2px var(--accent)}
.del{background:#0f1626;border:1px solid var(--border);color:var(--text);padding:6px 8px;border-radius:8px;cursor:pointer}
.viewport{position:relative;overflow:hidden;min-height:0;height:100%}#stage{position:absolute;inset:0;width:100%;height:100%}canvas{display:block}
.status-badge{position:absolute;top:12px;right:12px;z-index:7;background:color-mix(in srgb,var(--panel) 85%,transparent);border:1px solid var(--border);border-radius:10px;padding:6px 10px;font-size:12px;color:var(--muted);display:flex;gap:8px;align-items:center;pointer-events:none}.status-pill{padding:2px 8px;border:1px solid var(--border);border-radius:999px}
.hint-fab{position:absolute;left:12px;bottom:12px;z-index:6;width:40px;height:40px;border-radius:999px;background:color-mix(in srgb,var(--panel) 85%,transparent);border:1px solid var(--border);color:var(--muted);display:flex;align-items:center;justify-content:center;font-weight:900;cursor:pointer}
.hint{position:absolute;left:60px;right:12px;bottom:12px;background:color-mix(in srgb,var(--panel) 85%,transparent);border:1px solid var(--border);border-radius:10px;padding:10px;font-size:12px;color:var(--muted);z-index:5;transition:opacity .22s ease,transform .28s cubic-bezier(.2,.7,.2,1);transform-origin:left bottom}.hint.hidden{opacity:0;transform:translateY(8px) scaleX(.85);pointer-events:none}
.toast{position:fixed;bottom:14px;right:14px;background:color-mix(in srgb,var(--panel) 92%,transparent);border:1px solid var(--border);padding:10px 12px;border-radius:10px;display:none;z-index:1200}
.menu{position:relative}.menubtn{background:var(--panel2);border:1px solid var(--border);color:var(--text);padding:8px 10px;border-radius:10px;cursor:pointer;font-weight:700;display:inline-flex;align-items:center;gap:6px}.menu-pop{position:absolute;top:44px;left:0;min-width:220px;background:var(--panel);border:1px solid var(--border);border-radius:12px;padding:6px;display:none;z-index:2000;box-shadow:0 10px 24px rgba(0,0,0,.35)}.menu.open .menu-pop{display:block}.menuitem{display:flex;align-items:center;gap:8px;width:100%;padding:10px;border-radius:10px;background:transparent;border:1px solid transparent;color:var(--text);cursor:pointer;font-weight:700;text-align:left}.menuitem:hover{background:var(--panel2);border-color:var(--border)}
.toolbar{display:flex;gap:6px;flex-wrap:wrap;margin-bottom:8px}.toolbtn{background:#0f1626;border:1px solid var(--border);color:var(--text);padding:6px 10px;border-radius:999px;cursor:pointer;font-weight:700}.toolbtn.active{outline:2px solid var(--accent)}
.select,.input{background:#0f1420;border:1px solid var(--border);color:var(--text);padding:8px;border-radius:10px}.kv{display:grid;grid-template-columns:150px 1fr;gap:8px;align-items:center;margin-bottom:8px}
.section{margin-bottom:10px;border:0}.section>summary{list-style:none;cursor:pointer;display:flex;align-items:center;justify-content:space-between;gap:10px;font-weight:800;letter-spacing:.02em;color:var(--muted);background:linear-gradient(180deg,rgba(255,255,255,.02),rgba(0,0,0,.08));border:1px solid var(--border);border-radius:999px;padding:8px 12px}.section>summary::-webkit-details-marker{display:none}.section[open]>summary{border-color:var(--accent);box-shadow:inset 0 0 0 1px var(--accent)}.section .body{padding-top:10px}
.dropzone{border:1px dashed var(--border);background:var(--panel2);padding:10px;border-radius:12px;display:grid;grid-template-columns:56px 1fr auto;gap:10px;align-items:center;cursor:pointer;user-select:none}.dropzone.hover{outline:2px solid var(--accent);outline-offset:2px}.dropzone .preview{width:56px;height:56px;border-radius:8px;background:#0f1626;display:grid;place-items:center;overflow:hidden}.dropzone .preview img{width:100%;height:100%;object-fit:cover;display:block}
</style>
<script>window.__AREA={PUBLISH_ENDPOINT:"https://area-publish-proxy.area-webar.workers.dev/publish",FILE_BASE:"https://area-publish.area-webar.workers.dev",PUBLISH_KEY:"",VIEWER_BASE:"https://area-viewer.pages.dev"};</script>
<script type="importmap">{"imports":{"three":"https://unpkg.com/three@0.160.0/build/three.module.js","three/addons/":"https://unpkg.com/three@0.160.0/examples/jsm/","qrcode":"https://esm.sh/qrcode@1.5.3"}}</script>
<script>(function(){const AREA=(window.__AREA=window.__AREA||{});AREA.__origGlb=null;window.hasAnimationsInGlbBlob=async b=>{try{const ab=await b.arrayBuffer(),dv=new DataView(ab);if(dv.getUint32(0,true)!==0x46546c67||dv.getUint32(4,true)<2)return false;const jl=dv.getUint32(12,true),jt=dv.getUint32(16,true);if(jt!==0x4E4F534A)return false;const js=new TextDecoder().decode(new Uint8Array(ab,20,jl));try{return Array.isArray(JSON.parse(js).animations)&&JSON.parse(js).animations.length>0}catch{return /"animations"\\s*:\\s*\[/i.test(js)}}catch(e){return false}};const of=window.fetch.bind(window);window.fetch=async(i,n)=>{n=n||{};if((n.method||'GET').toUpperCase()!=='POST'||!(n.body instanceof FormData)||!AREA.__origGlb)return of(i,n);try{const u=typeof i==='string'?i:(i&&i.url)||'';const url=new URL(u,location.href);if(url.pathname!=='/publish')return of(i,n);const old=n.body,newFd=new FormData();let exporter=null;for(const [k,v]of old.entries()){if(k==='file'&&v instanceof File&&/scene\.glb$/i.test(v.name)){exporter=v;continue}newFd.append(k,v)}let chosen;if(!exporter){chosen=new Blob([AREA.__origGlb],{type:'model/gltf-binary'})}else{const anim=await window.hasAnimationsInGlbBlob(exporter);chosen=anim?exporter:new Blob([AREA.__origGlb],{type:'model/gltf-binary'})}newFd.append('file',chosen,'scene.glb');n={...n,body:newFd}}catch(e){return of(i,n)}return of(i,n)}})();</script>
<script>(function(){const AREA=(window.__AREA=window.__AREA||{});AREA.scene=AREA.scene||{};const v=(s,d='')=>{const e=document.querySelector(s);return e&&'value'in e?(e.value??d):d},c=(s,d=false)=>{const e=document.querySelector(s);return e&&'checked'in e?!!e.checked:d},n=(s,d)=>{const x=parseFloat(v(s,String(d)));return Number.isFinite(x)?x:d},f=s=>document.querySelector(s)?.files?.[0]||null;window.buildSceneJson=function(){const S=AREA.scene||(AREA.scene={}),a=(S.animation=S.animation||{}),au=(S.audio=S.audio||{}),ui=(S.ui=S.ui||{}),wl=(ui.welcome=ui.welcome||{});a.clipName=(v('#animClip','*')||'*').trim();a.start=(v('#animStartMode','onStart')||'onStart');a.loop=c('#animLoop',true);a.iterations=Math.max(1,n('#animRepeats',9999));au.autoplay=v('#audioAutoplay','withAnimation')||'withAnimation';au.loop=c('#audioLoop',true);au.volume=Math.min(1,Math.max(0,n('#audioVolume',0.85)));wl.eyebrow=v('#svEyebrow','');wl.title=v('#svTitle','ARea Scene');wl.desc=v('#svDesc','Tippe auf OK und platziere das 3D‑Objekt.');wl.nativeCta='ios-only';const p=f('#file-poster'),auF=f('#file-audio'),u=f('#fileUsdz');S.meta=S.meta||{};S.meta.title=wl.title;S.meta.description=wl.desc;S.meta.mode='area-viewer';S.model=S.model||{};S.model.url='scene.glb';if(u)S.model.usdzUrl='model.usdz';S.model.scale=typeof S.model.scale==='number'?S.model.scale:1;if(p)wl.poster=p.name;if(auF)au.url=auF.name;return JSON.parse(JSON.stringify(S))};})();</script>
<script>if(typeof buildViewerEntryForMode!=='function'){window.buildViewerEntryForMode=m=>({"surface-webxr":"/surface-ar/webxr.html","native":"/surface-ar/index.html","image":"/image-ar/viewer.html","scene-viewer":"/scene-viewer/index.html","surface-guided":"/surface-ar/guided.html","surface-area-viewer":"/surface-ar/area-viewer.html"}[m]||'/surface-ar/area-viewer.html')}if(typeof buildRobustViewerUrl!=='function'){window.buildRobustViewerUrl=({mode,sceneId,workerOrigin,viewerBase})=>{const e=buildViewerEntryForMode(mode),u=new URL(e,viewerBase),g=`${workerOrigin}/scenes/${encodeURIComponent(sceneId)}/scene.glb`;u.searchParams.set('glb',g);u.searchParams.set('scene',sceneId);u.searchParams.set('base',workerOrigin);if(mode==='native')u.searchParams.set('force','native');return u.toString()}}</script>
</head>
<body>
<div class="top">
  <a class="brand-logo" href="#" aria-label="Home"><img src="icons/Logo%20Area_v1.png" alt="AREA" draggable="false"></a>
  <div class="menu" id="projectMenu">
    <button id="btn-project-menu" class="menubtn ui-pill" aria-haspopup="true" aria-expanded="false">Projekt ▾</button>
    <div class="menu-pop" id="projectMenuPop" role="menu">
      <button id="btn-new" class="menuitem">+ Neues Projekt…</button>
      <label class="menuitem">Projekt öffnen <input id="file-project" type="file" accept=".webar,.json" hidden></label>
      <button id="btn-save" class="menuitem">Speichern</button>
      <button id="btn-save-as" class="menuitem">Speichern unter</button>
      <button id="btn-preview" class="menuitem">Vorschau (Module)</button>
      <button id="btn-preview-draft" class="menuitem">Schnell-Preview (Draft)</button>
      <button id="btn-publish" class="menuitem">Veröffentlichen</button>
    </div>
  </div>
  <label class="ui-pill">Objekt import <input id="file-glb" type="file" accept=".glb,.gltf,.fbx" hidden></label>
  <label class="ui-pill">Medien import <input id="file-media" type="file" accept="video/*,audio/*" hidden></label>
  <div class="sp"></div>
  <div class="status-pill" id="projNamePill" title="Doppelklick zum Umbenennen">Unbenanntes Projekt</div>
</div>
<div class="wrap">
  <div class="panel" id="left"><h3>Szene</h3><div class="content" id="leftContent"><div id="sceneList"></div></div></div>
  <div class="viewport"><div id="stage"></div><div id="vpStatus" class="status-badge"><span id="vp-pill-space" class="status-pill">Space: Local</span><span id="vp-pill-snap" class="status-pill">Snap: Aus</span></div><button id="hintFab" class="hint-fab" aria-expanded="false">i</button><div class="hint hidden">LMB drehen · Rad zoomen · RMB/Shift+LMB schwenken · Klick = Auswahl …</div></div>
  <div class="panel"><h3>Eigenschaften</h3><div class="content"><!-- Insert full toolbars & details sections here from working version (Transform/Scene/Look/Animation/Media) --></div></div>
</div>
<div class="toast" id="toast" aria-live="polite"></div>
<script type="module">/* Integrate full Three.js editor logic here (omitted for brevity). */</script>
</body>
</html>